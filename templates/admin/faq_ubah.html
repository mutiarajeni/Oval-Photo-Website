{% extends "admin/base_admin.html" %} {% block title %}Ubah FAQ Admin{% endblock
%} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="card my-4">
      <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
        <div class="bg-admin shadow-dark border-radius-lg pt-4 pb-3">
          <h6 class="text-white text-capitalize ps-3">Ubah FAQ</h6>
        </div>
      </div>
      <div class="card-body px-4 pb-4">
        <div class="table-responsive p-0">
          <!-- Menampilkan pesan error dari backend jika ada -->
          {% if error_message %}
          <div
            class="alert alert-danger alert-dismissible text-white"
            role="alert"
          >
            {{ error_message }}
            <button
              type="button"
              class="btn-close text-lg py-3 opacity-10"
              data-bs-dismiss="alert"
              aria-label="Close"
            >
              <span aria-hidden="true">Ã—</span>
            </button>
          </div>
          {% endif %}

          <form
            id="updateFaqForm"
            method="POST"
            action="/admin_faq_ubah/{{ faq._id }}"
          >
            <table class="table table-no-border">
              <tbody>
                <tr>
                  <td><label for="nama_pengaju">Nama Pengirim</label></td>
                  <td>
                    <div class="input-group input-group-outline">
                      <input
                        type="text"
                        class="form-control"
                        id="nama_pengaju"
                        name="nama_pengaju"
                        value="{{ faq.nama_pengaju if faq.nama_pengaju else '-' }}"
                        disabled
                      />
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><label for="email_pengaju">Email Pengirim</label></td>
                  <td>
                    <div class="input-group input-group-outline">
                      <input
                        type="email"
                        class="form-control"
                        id="email_pengaju"
                        name="email_pengaju"
                        value="{{ faq.email_pengaju if faq.email_pengaju else '-' }}"
                        disabled
                      />
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><label for="pertanyaan">Pertanyaan</label></td>
                  <td>
                    <div class="input-group input-group-outline">
                      <textarea
                        class="form-control"
                        id="pertanyaan"
                        name="pertanyaan"
                        rows="5"
                        required
                      >
{{ faq.pertanyaan }}</textarea
                      >
                    </div>
                  </td>
                </tr>
                <tr>
                  <td><label for="jawaban">Jawaban</label></td>
                  <td>
                    <div class="input-group input-group-outline">
                      <textarea
                        class="form-control"
                        id="jawaban"
                        name="jawaban"
                        rows="5"
                        required
                      >
{{ faq.jawaban }}</textarea
                      >
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="text-end mt-3">
              <a
                href="/admin_faq"
                class="btn btn-outline-dark me-2 fw-normal"
                style="text-transform: none; font-size: 1rem"
              >
                Kembali
              </a>
              <button
                type="submit"
                class="btn btn-dark fw-normal"
                style="text-transform: none; font-size: 1rem"
                id="submitButton"
                disabled
                {#
                Tetap
                disabled
                secara
                default
                #}
              >
                Simpan
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    // Bagian untuk enable/disable tombol tetap sama
    let initialPertanyaan = "";
    let initialJawaban = "";
    document.addEventListener("DOMContentLoaded", function () {
        initialPertanyaan = document.getElementById("pertanyaan").value.trim();
        initialJawaban = document.getElementById("jawaban").value.trim();
        checkFormChanges();
    });
    function checkFormChanges() {
        const currentPertanyaan = document.getElementById("pertanyaan").value.trim();
        const currentJawaban = document.getElementById("jawaban").value.trim();
        const submitButton = document.getElementById("submitButton");
        const isFormFilled = currentPertanyaan !== "" && currentJawaban !== "";
        const hasChanges = currentPertanyaan !== initialPertanyaan || currentJawaban !== initialJawaban;
        submitButton.disabled = !(isFormFilled && hasChanges);
    }
    document.querySelectorAll("#pertanyaan, #jawaban").forEach((input) => {
        input.addEventListener("input", checkFormChanges);
    });


    // --- BAGIAN INI YANG DIUBAH TOTAL ---
    document
        .getElementById("updateFaqForm")
        .addEventListener("submit", function (event) {
            // 1. Cegah form submit standar
            event.preventDefault(); 
            var form = this;

            // 2. Tampilkan konfirmasi "Yakin?"
            Swal.fire({
                title: "Apakah kamu yakin?",
                text: "FAQ akan diubah.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Ya, simpan!",
                cancelButtonText: "Batal",
            }).then((result) => {
                // 3. Jika pengguna setuju, kirim data dengan 'fetch'
                if (result.isConfirmed) {
                    
                    // Ambil data dari form
                    const formData = new FormData(form);
                    
                    // Kirim data ke server secara asynchronous
                    fetch(form.action, {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.json()) // Ubah respons menjadi JSON
                    .then(data => {
                        // 4. Tangani respons JSON dari server
                        if (data.status === 'success') {
                            // Jika SUKSES, tampilkan pesan dari server
                            Swal.fire({
                                title: "Berhasil!",
                                text: data.message, // Gunakan pesan dari server
                                icon: "success",
                                timer: 2000,
                                timerProgressBar: true,
                                didClose: () => {
                                    // Setelah pesan ditutup, redirect ke halaman utama
                                    window.location.href = "{{ url_for('admin_faq') }}";
                                }
                            });
                        } else {
                            // Jika GAGAL (error atau warning), tampilkan pesan error dari server
                            Swal.fire({
                                title: "Oops...",
                                text: data.message, // Gunakan pesan dari server
                                icon: data.status, // 'error' atau 'warning'
                            });
                        }
                    })
                    .catch(error => {
                        // Tangani jika ada error jaringan
                        console.error('Fetch Error:', error);
                        Swal.fire({
                            title: "Error Jaringan",
                            text: "Tidak bisa terhubung ke server.",
                            icon: "error",
                        });
                    });
                }
            });
        });
</script>

{% endblock %}
