{% extends "admin/base_admin.html" %} 
{% block title %}Tambah FAQ Admin{% endblock %} 
{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card my-4">
      <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
        <div class="bg-admin shadow-dark border-radius-lg pt-4 pb-3">
          <h6 class="text-white text-capitalize ps-3">Tambah FAQ</h6>
        </div>
      </div>
      <div class="card-body px-4 pb-4">
        <div class="table-responsive p-0">
          <!-- Hapus container mt-5 karena card-body sudah memberi padding -->
            <form id="addFaqForm" method="POST" action="{{ url_for('admin_faq_tambah') }}">
              <table class="table table-no-border">
                <tbody>
                  <tr>
                    <td><label for="pertanyaan">Pertanyaan</label></td>
                    <td>
                      <div class="input-group input-group-outline">
                        <!-- Hapus value dari backend karena tidak ada lagi redirect dengan parameter -->
                        <textarea class="form-control" id="pertanyaan" name="pertanyaan" rows="5" required></textarea>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td><label for="jawaban">Jawaban</label></td>
                    <td>
                      <div class="input-group input-group-outline">
                        <textarea class="form-control" id="jawaban" name="jawaban" rows="5" required></textarea>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="text-end mt-3">
                <a href="{{ url_for('admin_faq') }}" class="btn btn-outline-dark me-2 fw-normal" style="text-transform: none; font-size: 1rem">
                  Kembali
                </a>
                <button type="submit" class="btn btn-dark fw-normal" style="text-transform: none; font-size: 1rem" id="submitButton" disabled>
                  Simpan
                </button>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    // Bagian untuk enable/disable tombol tetap sama
    function checkFormFilled() {
        const pertanyaan = document.getElementById("pertanyaan").value.trim();
        const jawaban = document.getElementById("jawaban").value.trim();
        const submitButton = document.getElementById("submitButton");
        submitButton.disabled = !(pertanyaan && jawaban);
    }
    document.querySelectorAll("#pertanyaan, #jawaban").forEach((input) => {
        input.addEventListener("input", checkFormFilled);
    });
    document.addEventListener("DOMContentLoaded", checkFormFilled);


    // --- BAGIAN SUBMIT DIUBAH MENGGUNAKAN FETCH (AJAX) ---
    document.getElementById("addFaqForm").addEventListener("submit", function (event) {
        // 1. Cegah form submit standar
        event.preventDefault();
        var form = this;

        // 2. Tampilkan konfirmasi "Yakin?"
        Swal.fire({
            title: "Apakah kamu yakin?",
            text: "FAQ baru akan ditambahkan.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Ya, simpan!",
            cancelButtonText: "Batal",
        }).then((result) => {
            // 3. Jika pengguna setuju, kirim data dengan 'fetch'
            if (result.isConfirmed) {
                const formData = new FormData(form);

                fetch(form.action, {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    // 4. Tangani respons JSON dari server
                    if (data.status === 'success') {
                        // Jika SUKSES, tampilkan pesan di halaman ini
                        Swal.fire({
                            title: "Berhasil!",
                            text: data.message,
                            icon: "success",
                            timer: 2000,
                            timerProgressBar: true,
                            didClose: () => {
                                // Setelah pesan ditutup, redirect ke halaman daftar
                                window.location.href = "{{ url_for('admin_faq') }}";
                            }
                        });
                    } else {
                        // Jika GAGAL, tampilkan pesan error/warning dan tetap di halaman ini
                        Swal.fire({
                            title: "Gagal!",
                            text: data.message,
                            icon: data.status, // 'error' atau 'warning'
                        });
                    }
                })
                .catch(error => {
                    // Tangani jika ada error jaringan
                    console.error('Fetch Error:', error);
                    Swal.fire({
                        title: "Error Jaringan",
                        text: "Tidak bisa terhubung ke server.",
                        icon: "error",
                    });
                });
            }
        });
    });
</script>
{% endblock %}
